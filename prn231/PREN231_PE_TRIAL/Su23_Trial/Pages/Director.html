<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link href="lid/bootstrap-4.0.0-dist/css/bootstrap.css" rel="stylesheet" />
    <link href="lid/bootstrap-4.0.0-dist/css/bootstrap.min.css" rel="stylesheet" />

    
    
    <title></title>
</head>
<body>
    <div class="container">
        <h1>Search Directors</h1>
        <div class="d-flex w-75 mt-3">
            <input type="text" placeholder="Nationality" id="nationality" class="form-control me-1" />
            <input type="text" placeholder="Gender" id="gender" class="form-control me-1" />
            <button class="btn btn-outline-secondary" id="Search">Search</button>
        </div>
        <div class="row mt-3">
            <div class="col-md-8" id="table-master"></div>
            <div class="col-md-4" id="table-detail"></div>
        </div>
    </div>

<script src="lid/jquery/jquery.js"></script>
    <script>

      $(document).ready(() => {

          $("#Search").click(() => {
              let gender = $("#gender").val(),
                  nationality = $("#nationality").val();
              console.log(gender);
              console.log(nationality);
              $.ajax({
                  url: 'https://localhost:5000/api/Director/GetDirectors/'+nationality+'/'+gender,
                  method: 'GET',
                  contentType: 'application/json',
                  success: (data) => {
                      $('#table-master').html('');
                      if(data) {
                          $('#table-master').html(generateHTMLTable(data));
                      }

                  }

              });
          });
          const generateHTMLTable = (data) => {
              let tableContent = `
              <table class="table table-bordered">
                  <thead>
                  <tr>
                      <td>Director ID</td>
                      <td>Full Name</td>
                      <td>Male</td>
                      <td>Date of Birth</td>
                      <td>Description</td>
                      <td>Nationality</td>
                      <td></td>

                  </tr>
            </thead >
              <tbody>
                  {0}
              </tbody>
        </table >`;

        let tableData = '';
          data.forEach(element => {
              tableData += `
               < tr >
                      <td>${element.id}</td>
                      <td>${element.fullName}</td>
                      <td>${element.gender}</td>
                      <td>${element.dobString}</td>
                      <td>${element.nationality}</td>
                      <td>${element.description}</td>
                      <td>  <a href="javascript:void(0)" data-id="${element.id}" class="viewDetail">Details</a></td>
              </tr >
              `; 
          });
          return tableContent = tableContent.replace("{0}", tableData);

          }
          $(document).on('click', '.viewDetail',function() {
              let gender = $(this).attr("data-id");
              console.log(gender);
              $.ajax({
                  url: 'https://localhost:5000/api/Director/GetDirector/' +gender,
                  method: 'GET',
                  contentType: 'application/json',
                  success: (data) => {
                      $('#table-detail').html('');
                      if (data) {
                          $('#table-detail').html(generateDetailHTMLTable(data));
                          
                      }

                  }

              });
          });
          const generateDetailHTMLTable = (data) => {


              return `<h3>List of movies of ${data.fullName} </h3>
                        <ul>
                        ${data.movies.map(x => `<li> ${x.title}- Release Year: ${x.releasYear}</li>`).join('')}
                        
                        </ul>

              `; 
          }

      })


    </script>

</body>
</html>